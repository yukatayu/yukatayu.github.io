<!doctype html><html lang=ja-jp><head><meta charset=utf-8><title>もふもふ自由帳</title>
<meta property="og:url" content="https://blog.yukatayu.tech/blog/pixel_morphing/"><meta property="og:site_name" content="もふもふ自由帳"><meta property="og:title" content="もふingと距離"><meta property="og:description" content="ピクセル画像に対してモーフィングをします。"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-08-30T20:24:18+09:00"><meta property="article:modified_time" content="2024-08-30T20:24:18+09:00"><meta property="article:tag" content="表現"><meta property="og:image" content="https://blog.yukatayu.tech/images/2024/VRChat_2022-08-29_11-59-43.562_3840x2160_resize.png"><meta name=twitter:card content="summary"><meta name=twitter:title content="もふingと距離"><meta name=twitter:description content="ピクセル画像に対してモーフィングをします。"><meta name=twitter:image content="https://blog.yukatayu.tech/images/2024/VRChat_2022-08-29_11-59-43.562_3840x2160_resize.png"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="ピクセル画像に対してモーフィングをします。"><meta name=author content="yukatayu"><meta name=generator content="Hugo 0.133.0"><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/slick/slick.css><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/venobox/venobox.css><link rel=stylesheet href=https://blog.yukatayu.tech/scss/style.min.css media=screen><link rel="shortcut icon" href=https://blog.yukatayu.tech/images/favicon.png type=image/x-icon><link rel=icon href=https://blog.yukatayu.tech/images/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml title="RSS Feed" href=https://blog.yukatayu.tech/index.xml><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","G-W6LQCKQ185","auto"),ga("send","pageview")</script></head><body><div class=preloader></div><header class=navigation><div class=container><nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0"><a class="navbar-brand mobile-view" href=https://blog.yukatayu.tech/><img class=img-fluid src=https://blog.yukatayu.tech/images/logo.png alt=もふもふ自由帳></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class=ti-menu></i></button><div class="collapse navbar-collapse text-center" id=navigation><div class=desktop-view><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://twitter.com/yukata_yu><i class=ti-twitter-alt></i></a></li><li class=nav-item><a class=nav-link href=https://www.youtube.com/@yukatayu><i class=ti-youtube></i></a></li><li class=nav-item><a class=nav-link href=https://www.nicovideo.jp/user/57110574/video><i class=ti-desktop></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/yukatayu/><i class=ti-github></i></a></li><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/index.xml><i class=ti-rss-alt></i></a></li></ul></div><a class="navbar-brand mx-auto desktop-view" href=https://blog.yukatayu.tech/><img class=img-fluid src=https://blog.yukatayu.tech/images/logo.png alt=もふもふ自由帳></a><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/works/>Works</a></li><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/about/>About</a></li></ul></div></nav></div></header><section class=section-sm><div class=container><div class=row><div class="col-lg-8 mx-auto"><a href=/categories/%e6%8a%80%e8%a1%93 class=text-primary>技術</a><h2>もふingと距離</h2><div class="mb-3 post-meta"><span>By yukatayu</span>
<span class="border-bottom border-primary px-2 mx-1"></span>
<span>30 August 2024</span></div><img src=https://blog.yukatayu.tech/images/2024/VRChat_2022-08-29_11-59-43.562_3840x2160_resize.png class="img-fluid w-100 mb-4" alt=もふingと距離><div class="content mb-5"><h2 id=はじめに>はじめに</h2><p>この記事では， Signed Distance Field の計算をします。<br>内容は薄めなのです。</p><hr><h2 id=方眼紙を押し込む>方眼紙を押し込む</h2><p>私たちの目に見えている世界は，輪郭も色も滑らかです。
その中に存在しているはずのピクセル画像は，その縁をなぞると，でこぼこしています。</p><p>拡大するとギザギザしていますし，グラデーションをよく見ると継ぎ目が見えてしまいます。
様々な大きさの画面が存在する世界でこの縁に触れてしまうと，じんわりと痛みが走ります。</p><p>今回は，この輪郭を綺麗にすることを考えてみます。</p><hr><p>Signed Distance Field（以下SDF）という「場」があります。</p><p>これは符号付きの無次元量であり，物体の表面からの距離に比例します。
この場を高さ0で切り取った等高線は，その物体の輪郭となります。
当然，任意の次元に対して計算できるものですが，今回は2次元の画像について考えてみます。
3次元のボクセルは可視化が難しいですからね。</p><p>SDFで表現することで，ピクセル画像は<u>真に</u>斜めの線を表現できます。<br>その代わりに失われている物がある事にも気を付けてくださいね。</p><p>そう，色です。</p><hr><h2 id=計算する>計算する</h2><p>ひとまず実装したものが<a href=https://github.com/yukatayu/sdf_morphing/blob/main/Main.cpp>これ</a>です。</p><p>基本的には以下の工程を，内外を裏返して2回行っています。</p><pre tabindex=0><code>各ピクセルは，一番近い内部ピクセル座標（以下「最短座標」）と，
そこまでの距離（以下「最短距離」）を持ちます。

1. 内側の全てのピクセルに対し，
	1.1. 「最短距離は0」「最短座標は自分自身」と記録します。
	1.2. 座標をキューに詰めます。
2. 幅優先探索で，キューから座標を取り出します。
	2.1. 上下左右のピクセルに対し，最短座標を教えます
	2.2. 自分が知っている最短座標の方が相手から見て近い場合，
		2.2.1. 最短座標と最短距離を更新します。
		2.2.2. 最短距離が更新されたピクセルをキューに詰めます。
</code></pre><p>つまりは，方眼紙の交点をノードと見なしたグラフで dijkstra 法を行っています。</p><p>今回はC++23で実装しましたけれど，もし実装する際にはお好みの言語を使ってみてください。</p><hr><h3 id=引っ張る>引っ張る</h3><p>例えば，「★」のSDFは，このような形をしています。</p><figure class=center><img src=/images/2024/morphing/0_0_sdf.png width=320 height=640></figure><p>同様に，「↑」のSDFは，このような形をしています。</p><figure class=center><img src=/images/2024/morphing/0_1_sdf.png width=320 height=640></figure><hr><p>普段画像を重ね合わせる際，色の中間状態を取っているはずです。</p><p>では，これらの中間状態を取るとどうなるのでしょうか。</p><figure class=center><img src=/images/2024/morphing/sdf_morphing_graph_0.gif width=320 height=640></figure><p>答えは明快で，断面の形は滑らかに切り替わります。<br>滑らかといっても，鋭角の移り変わりかたに多少の痛みを感じます。
これは線形補間によるものです。</p><figure class=center><img src=/images/2024/morphing/0_big.gif width=320 height=640></figure><hr><p>この滑らかさは，トポロジーの維持とは全く関係ありません。
例えば，全く無関係な形同士でモーフィングさせてみると，このように滲んだような表現になります。</p><p>何か面白い応用例が浮かんだら教えて頂けると，そっと喜びます。</p><figure class=center><img src=/images/2024/morphing/sdf_morphing_graph_1.gif width=320 height=640></figure><figure class=center><img src=/images/2024/morphing/1_big.gif width=320 height=640></figure><hr><p>今回は，「色を犠牲にして形を表現する」記事を書こうと思ったのですが，題材が単純であったため，実質的に幅優先探索の実装練習のようになってしまいました。<br>この手法は一般の次元で適用できますので，ボクセルのモーフィングなども，そのうち試してみますね。</p><p>それでは。</p></div></div></div></div></section><footer class=text-capitalize><div class=container><div class="row justify-content-center"><div class="col-12 text-center mb-5"><a href=https://blog.yukatayu.tech/><img src=https://blog.yukatayu.tech/images/logo.png alt=もふもふ自由帳></a></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Contact Me</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=mailto:blog@yukatayu.tech style=text-transform:none><i class="ti-email mr-3 text-primary"></i>blog@yukatayu.tech</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Social Contacts</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://twitter.com/yukata_yu>twitter</a></li><li class=mb-3><a class=text-dark href=https://www.youtube.com/@yukatayu>youtube</a></li><li class=mb-3><a class=text-dark href=https://www.nicovideo.jp/user/57110574/video>niconico</a></li><li class=mb-3><a class=text-dark href=https://github.com/yukatayu/>GitHub</a></li><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/index.xml>RSS</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Categories</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=/categories/%e6%8a%80%e8%a1%93/>技術</a></li><li class=mb-3><a class=text-dark href=/categories/%e6%97%a5%e8%a8%98/>日記</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Quick Links</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/works/>Works</a></li><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/blog/>Blog</a></li><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/about/>About</a></li></ul></div><div class="col-12 border-top py-4 text-center">© yukatayu</div></div></div></footer><script>var indexURL="https://blog.yukatayu.tech/index.json"</script><script src=https://blog.yukatayu.tech/plugins/jQuery/jquery.min.js></script><script src=https://blog.yukatayu.tech/plugins/bootstrap/bootstrap.min.js></script><script src=https://blog.yukatayu.tech/plugins/slick/slick.min.js></script><script src=https://blog.yukatayu.tech/plugins/venobox/venobox.min.js></script><script src=https://blog.yukatayu.tech/plugins/search/fuse.min.js></script><script src=https://blog.yukatayu.tech/plugins/search/mark.js></script><script src=https://blog.yukatayu.tech/plugins/search/search.js></script><script src=https://blog.yukatayu.tech/js/script.min.js></script></body></html>