<!doctype html><html lang=ja-jp><head><meta charset=utf-8><title>もふもふ自由帳</title><meta property="og:title" content="同期に特化した言語を考えてみる（１）"><meta property="og:description" content="プログラム同士の通信を簡単に記述できる言語について考えてみます。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.yukatayu.tech/blog/sync_language_01/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-08-14T14:07:05+09:00"><meta property="article:modified_time" content="2024-08-14T14:07:05+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="同期に特化した言語を考えてみる（１）"><meta name=twitter:description content="プログラム同士の通信を簡単に記述できる言語について考えてみます。"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="ゆかたゆのブログです。"><meta name=author content="yukatayu"><meta name=theme-name content="liva-hugo"><meta name=generator content="Hugo 0.110.0"><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/slick/slick.css><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/venobox/venobox.css><link rel=stylesheet href=https://blog.yukatayu.tech/scss/style.min.css media=screen><link rel="shortcut icon" href=https://blog.yukatayu.tech/images/favicon.png type=image/x-icon><link rel=icon href=https://blog.yukatayu.tech/images/favicon.png type=image/x-icon><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","","auto"),ga("send","pageview")</script></head><body><div class=preloader></div><header class=navigation><div class=container><nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0"><a class="navbar-brand mobile-view" href=https://blog.yukatayu.tech/><img class=img-fluid src=https://blog.yukatayu.tech/images/logo.png alt=もふもふ自由帳></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class=ti-menu></i></button><div class="collapse navbar-collapse text-center" id=navigation><div class=desktop-view><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://twitter.com/yukata_yu><i class=ti-twitter-alt></i></a></li><li class=nav-item><a class=nav-link href=https://www.youtube.com/@yukatayu><i class=ti-youtube></i></a></li><li class=nav-item><a class=nav-link href=https://www.nicovideo.jp/user/57110574/video><i class=ti-desktop></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/yukatayu/><i class=ti-github></i></a></li><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/index.xml><i class=ti-rss-alt></i></a></li></ul></div><a class="navbar-brand mx-auto desktop-view" href=https://blog.yukatayu.tech/><img class=img-fluid src=https://blog.yukatayu.tech/images/logo.png alt=もふもふ自由帳></a><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/works/>Works</a></li><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/about/>About</a></li></ul></div></nav></div></header><section class=section-sm><div class=container><div class=row><div class="col-lg-8 mx-auto"><a href=/categories/blog class=text-primary>Blog</a><h2>同期に特化した言語を考えてみる（１）</h2><div class="mb-3 post-meta"><span>By yukatayu</span>
<span class="border-bottom border-primary px-2 mx-1"></span>
<span>14 August 2024</span></div><img src=https://blog.yukatayu.tech/images/2024/VRChat_2023-08-14_13-15-18.482_1920x1080_resize.png class="img-fluid w-100 mb-4" alt=同期に特化した言語を考えてみる（１）><div class="content mb-5"><h2 id=はじめに>はじめに</h2><p>この記事は，考え途中のアイデアをそのまま書き出したものです。<br>読んだからと言って，何か結論が得られるものではありません。</p><ul><li>次回： まだです。</li></ul><h2 id=動機>動機</h2><p>普段プログラムを書く際，各プログラムのインターフェースを定義した後に，それぞれのプログラムを書き始めると思います。</p><p>ですが，開かれたシステムでない限り，そのインターフェースは実装の結果生まれて物でしかないと思うのです。
実装に取り掛かる前に，ノード間通信を定義させられるのは，早すぎる具体化なのではないでしょうか。</p><hr><p>ここで言う開かれたシステムというのは，例えばWWWのことです。
もし仮に，HTTPの定義を皆が勝手に拡張していたら，世の中のブラウザは今ほど便利ではなかったでしょう。
TCPで通信しているところに意味不明なトラフィックが流入していたら，TCPのスライディングウィンドウが一瞬で閉じてしまい，快適に通信できなかったでしょう。</p><p>このように「よそ」と繋がる可能性のある存在は，自身の解する言語を事前に表明しておく必要があります。</p><hr><p>ここで，システムが開いているか閉じているかというのは，ネットワークのレイヤーによるのではないかという考えが生じます。
実際，OSI参照モデルの7層（アプリケーション層）は，閉じていると言っていい物が殆どでしょう。</p><p>話を戻しましょう。</p><p>協調動作する複数のプログラムを書く際に，「各プログラムの入出力を定義する」のは，閉じたシステムの内側に立ち入る行為です。
実際に必要とされているものは，「システム全体」と「外界」の間の通信のみを定義すれば開発を開始できるような存在ではないでしょうか。</p><hr><p>実際のところ，「システム全体」と「外界」の通信というのは，従来の開発手法を文脈とすると余りに自明です。だって「各プログラムの入出力」に含まれていますからね。</p><p>それでは，複数のプログラムからなるシステムの内側を記述するような存在について考えると，これがなかなか難しいのです。</p><h2 id=素朴な考え>素朴な考え</h2><p>例えば，サーバ（Sとします）に2つのクライアント（それぞれA,Bとします）が接続しているゲームを考えます。</p><p>「AがBを攻撃した」という処理を行う時，全体としては「<code>b.hp -= a.attack_power</code>」という処理が行われます。</p><p>これを実行する際には，各処理が行われる場所について，例えば以下のような物が考えられます。</p><ul><li>ステータス管理も攻撃処理もサーバで行う<ol><li>Aからサーバに，攻撃したことを報告する</li><li>サーバから全体に，新たなBのHPを報告する</li></ol></li><li>ステータス管理は各個人で行い，攻撃処理は被攻撃者が行う<ol><li>Aからサーバに，攻撃したことと，その攻撃力を報告する</li><li>サーバからBに，攻撃を受けたことと，その攻撃力を報告する</li><li>Bは，減算後のHPをサーバに報告する</li></ol></li><li>ステータス管理は各個人で行い，攻撃処理は攻撃者が行う<ol><li>Aから全体に，Bの新たなHPを報告する</li></ol></li></ul><p>これらは全て，システム全体では「<code>b.hp -= a.attack_power</code>」をしているだけです。
しかし，その評価を行う場所を変化させるためだけに，必要なインターフェースが大きく変化しています。</p><hr><p>例えば，ある処理をサーバーで行うことを <code>S[_]</code> で表してみます。
同様に，Aで行う場合には <code>A[_]</code>，Bで行う時には <code>B[_]</code> で表します。</p><p>例えば，Aの世界でだけBのHPを10減らすには，<code>A[b.hp -= 10]</code> と表記します。</p><p>先ほどの3つの例をこの表記で書き直してみると，それぞれ以下のようになりそうです。</p><ul><li><code>A[ S[b.hp -= a.attack_power] ]</code></li><li><code>A[ B[b.hp -= A[a.attack_power]] ]</code></li><li><code>A[ b.hp -= a.attack_power ]</code></li></ul><p>ここで生じる疑問として，3つ目の処理において「Aから全体に通知」といった処理が飛ばされているように見えます。
しかし，システム全体の話をしているのですから，計算結果は即座に通知されて当然に見えます。</p><p>そこで，各変数の単位（誰に対して定義されるか）と，所有者（変数の問い合わせ先）を定義する必要があります。</p><p>この二つは同じものに見えるかもしれませんが，例えば「クライアントの人数分，サーバ側で保持する変数」という物も考えられますね。
（もしかしたらこのケースについては <code>Node→_</code> なる値を確保することで解決するかもしれませんが，その場合には書き込み権限やロック周りが複雑になる気がします…… ）</p><hr><p>では，ここまでを纏めて，疑似的なコードを書いてみます。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-hs data-lang=hs><span class=line><span class=cl><span class=kt>Network</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>S</span> <span class=ow>-&gt;</span> <span class=p>{</span> <span class=kt>A</span><span class=p>,</span> <span class=kt>B</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>struct</span> <span class=kt>Player</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>int</span> <span class=n>hp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>int</span> <span class=n>atk</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ケース1： ステータス管理も攻撃処理もサーバで行う</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-hs data-lang=hs><span class=line><span class=cl><span class=kt>S</span><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=kt>A</span><span class=p>]</span> <span class=kt>Player</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=kt>B</span><span class=p>]</span> <span class=kt>Player</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>A</span><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=n>when</span> <span class=kt>A</span><span class=o>.</span><span class=n>attack</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>S</span><span class=p>[</span> <span class=n>b</span><span class=o>.</span><span class=n>hp</span> <span class=o>-=</span> <span class=n>a</span><span class=o>.</span><span class=n>atk</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>ケース2： ステータス管理は各個人で行い，攻撃処理は被攻撃者が行う</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-hs data-lang=hs><span class=line><span class=cl><span class=kt>A</span><span class=p>[</span> <span class=kt>Player</span> <span class=n>a</span><span class=p>;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=kt>B</span><span class=p>[</span> <span class=kt>Player</span> <span class=n>b</span><span class=p>;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>A</span><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=n>when</span> <span class=kt>A</span><span class=o>.</span><span class=n>attack</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>B</span><span class=p>[</span> <span class=n>b</span><span class=o>.</span><span class=n>hp</span> <span class=o>-=</span> <span class=n>a</span><span class=o>.</span><span class=n>atk</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>ケース3： ステータス管理は各個人で行い，攻撃処理は攻撃者が行う</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-hs data-lang=hs><span class=line><span class=cl><span class=kt>A</span><span class=p>[</span> <span class=kt>Player</span> <span class=n>a</span><span class=p>;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=kt>B</span><span class=p>[</span> <span class=kt>Player</span> <span class=n>b</span><span class=p>;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>A</span><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=n>when</span> <span class=kt>A</span><span class=o>.</span><span class=n>attack</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=o>.</span><span class=n>hp</span> <span class=o>-=</span> <span class=n>a</span><span class=o>.</span><span class=n>atk</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>表記の見た目は非本質ですので，直感で書いています。
そのうちちゃんと考えますね。</p><hr><p>次回は，システムを後から拡張する場合について考えてみようと思います。</p><p>ではまた。</p></div></div></div></div></section><footer class=text-capitalize><div class=container><div class="row justify-content-center"><div class="col-12 text-center mb-5"><a href=https://blog.yukatayu.tech/><img src=https://blog.yukatayu.tech/images/logo.png alt=もふもふ自由帳></a></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Social Contacts</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://twitter.com/yukata_yu>twitter</a></li><li class=mb-3><a class=text-dark href=https://www.youtube.com/@yukatayu>youtube</a></li><li class=mb-3><a class=text-dark href=https://www.nicovideo.jp/user/57110574/video>niconico</a></li><li class=mb-3><a class=text-dark href=https://github.com/yukatayu/>GitHub</a></li><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/index.xml>RSS</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Categories</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=/categories/blog/>Blog</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Quick Links</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/works/>Works</a></li><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/about/>About</a></li></ul></div><div class="col-12 border-top py-4 text-center">© yukatayu</div></div></div></footer><script>var indexURL="https://blog.yukatayu.tech/index.json"</script><script src=https://blog.yukatayu.tech/plugins/jQuery/jquery.min.js></script>
<script src=https://blog.yukatayu.tech/plugins/bootstrap/bootstrap.min.js></script>
<script src=https://blog.yukatayu.tech/plugins/slick/slick.min.js></script>
<script src=https://blog.yukatayu.tech/plugins/venobox/venobox.min.js></script>
<script src=https://blog.yukatayu.tech/plugins/search/fuse.min.js></script>
<script src=https://blog.yukatayu.tech/plugins/search/mark.js></script>
<script src=https://blog.yukatayu.tech/plugins/search/search.js></script>
<script src=https://blog.yukatayu.tech/js/script.min.js></script></body></html>