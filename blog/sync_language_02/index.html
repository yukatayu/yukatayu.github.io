<!doctype html><html lang=ja-jp><head><meta charset=utf-8><title>もふもふ自由帳</title>
<meta property="og:url" content="https://blog.yukatayu.tech/blog/sync_language_02/"><meta property="og:site_name" content="もふもふ自由帳"><meta property="og:title" content="同期に特化した言語を考えてみる（２）"><meta property="og:description" content="ネットワークシステムを拡張する際の事を考えてみます。"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-09-03T10:39:00+09:00"><meta property="article:modified_time" content="2024-09-03T10:39:00+09:00"><meta property="article:tag" content="言語"><meta property="article:tag" content="同期"><meta property="og:image" content="https://blog.yukatayu.tech/images/2024/VRChat_2023-08-14_13-46-45.608_3840x2160_resize.png"><meta name=twitter:card content="summary"><meta name=twitter:title content="同期に特化した言語を考えてみる（２）"><meta name=twitter:description content="ネットワークシステムを拡張する際の事を考えてみます。"><meta name=twitter:image content="https://blog.yukatayu.tech/images/2024/VRChat_2023-08-14_13-46-45.608_3840x2160_resize.png"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="ネットワークシステムを拡張する際の事を考えてみます。"><meta name=author content="yukatayu"><meta name=generator content="Hugo 0.133.0"><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/slick/slick.css><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://blog.yukatayu.tech/plugins/venobox/venobox.css><link rel=stylesheet href=https://blog.yukatayu.tech/scss/style.min.css media=screen><link rel="shortcut icon" href=https://blog.yukatayu.tech/images/favicon.png type=image/x-icon><link rel=icon href=https://blog.yukatayu.tech/images/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml title="RSS Feed" href=https://blog.yukatayu.tech/index.xml><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","G-W6LQCKQ185","auto"),ga("send","pageview")</script></head><body><div class=preloader></div><header class=navigation><div class=container><nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0"><a class="navbar-brand mobile-view" href=https://blog.yukatayu.tech/><img class=img-fluid src=https://blog.yukatayu.tech/images/logo.png alt=もふもふ自由帳></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class=ti-menu></i></button><div class="collapse navbar-collapse text-center" id=navigation><div class=desktop-view><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://twitter.com/yukata_yu><i class=ti-twitter-alt></i></a></li><li class=nav-item><a class=nav-link href=https://www.youtube.com/@yukatayu><i class=ti-youtube></i></a></li><li class=nav-item><a class=nav-link href=https://www.nicovideo.jp/user/57110574/video><i class=ti-desktop></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/yukatayu/><i class=ti-github></i></a></li><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/index.xml><i class=ti-rss-alt></i></a></li></ul></div><a class="navbar-brand mx-auto desktop-view" href=https://blog.yukatayu.tech/><img class=img-fluid src=https://blog.yukatayu.tech/images/logo.png alt=もふもふ自由帳></a><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/works/>Works</a></li><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=https://blog.yukatayu.tech/about/>About</a></li></ul></div></nav></div></header><section class=section-sm><div class=container><div class=row><div class="col-lg-8 mx-auto"><a href=/categories/%e6%8a%80%e8%a1%93 class=text-primary>技術</a><h2>同期に特化した言語を考えてみる（２）</h2><div class="mb-3 post-meta"><span>By yukatayu</span>
<span class="border-bottom border-primary px-2 mx-1"></span>
<span>03 September 2024</span></div><img src=https://blog.yukatayu.tech/images/2024/VRChat_2023-08-14_13-46-45.608_3840x2160_resize.png class="img-fluid w-100 mb-4" alt=同期に特化した言語を考えてみる（２）><div class="content mb-5"><h2 id=はじめに>はじめに</h2><p>この記事は，考え途中のアイデアをそのまま書き出したものです。<br>自分でも考えをまとめ切れていないため，表現が分かりづらいかもしれません。</p><ul><li>前回： <a href=/blog/sync_language_01>同期に特化した言語を考えてみる（１）</a></li><li>次回： まだです。</li></ul><hr><h2 id=土地と建物と人>土地と建物と人</h2><p>人は大抵，土地の上に立った家の中に住んでいます。その中に自分の好きな物を置いて，それらに囲まれながら生きています。</p><p>VRSNS等でも，プラットフォームが先に存在して，その上にワールドがあり，その中にアバターが居ると思います。</p><p>この順序をひっくり返すことは，全体の構成が変わらない限りは不可能です。</p><hr><p>例えばVR空間で「部屋の中に\(A\)と\(B\)が居て，マグカップ \(C_A, C_B\) をそれぞれ持っている」という状況を考えてみます。</p><p>この時，部屋の子オブジェクトとして \(\lbrace A, B, C_A, C_B \rbrace\) がある場合と，子が\(\lbrace A, B \rbrace\) で孫が \(\lbrace C_A, C_B \rbrace\) の場合が考えられますね。</p><p>ワールド（⊃部屋）の子オブジェクトがアバターのみの場合，アイテムの挙動はアバターの一部として捉えられている筈です。
つまり，「アバター（↢プレイヤー）」が全てを包含するような存在として設計されていれば，それ以外のアイテムなどを取り扱うには特別な事は要らないはずです。</p><p>でも，それはいわゆる神クラスを作ることであり，ひいては何も定めないのと同じです。</p><p>対して，部屋の子オブジェクトとして \(\lbrace A, B, C_A, C_B \rbrace\) がある場合，それぞれの存在が個別に定義されますし，これは既存のVRSNS（e.g. VRChat）の構造にも近いので納得感があります。</p><hr><h2 id=重なる世界>重なる世界</h2><p>では，新たな挙動をする存在をワールド上に存在させたいと思った時には，どのような処理が行われるべきでしょうか。</p><hr><p>その前に，単一のネットワークについて考えてみましょう。</p><p>まず，値XとYがある時，これらの値は次の何れかで決定されます</p><ul><li>XとYは互いに無関係</li><li>XはYの関数（Yが決まるとXが決まる）</li><li>YはXの関数（Xが決まるとYが決まる）</li></ul><hr><p>「YとXが相互に依存している」という場面の考慮が必要になると思うかもしれませんが，それができる以上は，YからXへの変換が存在します。
従って，Xを自由変数にした上で常にXを変更することで，両方向の変換を後から実装できるということです。
言語機能として実装する必要は無いですので，この場では考慮しないことにします。</p><p>この時，「関数である」関係を有向グラフとした時，そのグラフは明らかに非巡回有向グラフとなります。
（巡回があると，互いに関係する2つの変数が存在してしまうため）</p><hr><p>変数の関係が非巡回有向グラフとなる事実は，アイテムがどれだけ追加されても覆らない筈です。
ですが，一般のグラフを実行時に随時検査することはそれなりに難しく，何らかの追加制約が必要に思われます。</p><p>ここで先ほど挙げた「プラットフォーム→ワールド→アバターの順に存在する」という事実を踏まえると，グラフ同士の間に非巡回有向グラフを設定し，依存元グラフは依存先グラフの全ての変数を読み取れるようにします。</p><p>この時，変数は自明に非巡回有向グラフになります。</p><p>さらに，「プラットフォームだけ」「プラットフォームとワールドだけ」でもシステムが存在できるようになります。
変数寿命管理の観点でも有利に働きそうですね。</p><p>ただし，外部との通信を抽象化する部分は，必ずその森の根になります。書き込みエフェクト発生がデータ送信ですね。</p><hr><p>これらの多重ネットワークによって，</p><ul><li>複数のレイヤーにおける非巡回の依存グラフ</li><li>複数の横並びの存在における依存グラフ</li><li>これらを接続するための，同じノードタイプのインスタンス間の通信
を実装していきます。</li></ul><hr><h2 id=表現>表現</h2><p>これらを表現する場合でも，基本的には前回記事と同じ表現で出来ると思います。</p><p>素朴には，参加者の定義と，そのグラフを持っておきます。
グラフ同士には権限設定用の弱順序があり，最小のグラフをただひとつ持ちます。
プラットフォームは，その最小のグラフをエントリーポイントとして起動します。</p><p>それから，前回何の説明もなく <code>b.hp</code> などのプロパティ変数を出してしまいました。
このように，各変数は｢この参加者に対して1つ定義される｣というlocalityを持つはずです。
localityを参加者の定義とくっつけても本当に良いのかについても，そのうち考えたいですね。
もしかしたら，所有権の移転などもできると嬉しいかもしれませんので。</p><hr><h2 id=書き込む>書き込む</h2><p>ここまで依存グラフの存在について触れてきましたが，実際に影響を起こす時の事を考えてみます。</p><p>依存グラフの方向に影響を伝播させるときには，値を単に参照すれば良いです。</p><p>対して，依存グラフを遡るようなエフェクトを発生させるときには，時間の差を考える必要があります。
基本的には，エフェクトが発生した時点でベクタークロックを付けてリクエストを送り，何らかの検査後に作用を起こせば良さそうです。</p><p>流石に記事が長くなってしまうので，この話題は次回に回そうと思います。</p><hr><p>あとは何についての考慮が足りていないのでしょうか？ ……atomic性とロールバックですね。</p><p>道のりは長そうですけれど，次回以降考えてみます。</p><p>それではまた。</p></div></div></div></div></section><footer class=text-capitalize><div class=container><div class="row justify-content-center"><div class="col-12 text-center mb-5"><a href=https://blog.yukatayu.tech/><img src=https://blog.yukatayu.tech/images/logo.png alt=もふもふ自由帳></a></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Contact Me</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=mailto:blog@yukatayu.tech style=text-transform:none><i class="ti-email mr-3 text-primary"></i>blog@yukatayu.tech</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Social Contacts</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://twitter.com/yukata_yu>twitter</a></li><li class=mb-3><a class=text-dark href=https://www.youtube.com/@yukatayu>youtube</a></li><li class=mb-3><a class=text-dark href=https://www.nicovideo.jp/user/57110574/video>niconico</a></li><li class=mb-3><a class=text-dark href=https://github.com/yukatayu/>GitHub</a></li><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/index.xml>RSS</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Categories</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=/categories/%e6%8a%80%e8%a1%93/>技術</a></li><li class=mb-3><a class=text-dark href=/categories/%e6%97%a5%e8%a8%98/>日記</a></li></ul></div><div class="col-lg-3 col-sm-6 mb-5"><h6 class=mb-4>Quick Links</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/works/>Works</a></li><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/blog/>Blog</a></li><li class=mb-3><a class=text-dark href=https://blog.yukatayu.tech/about/>About</a></li></ul></div><div class="col-12 border-top py-4 text-center">© yukatayu</div></div></div></footer><script>var indexURL="https://blog.yukatayu.tech/index.json"</script><script src=https://blog.yukatayu.tech/plugins/jQuery/jquery.min.js></script><script src=https://blog.yukatayu.tech/plugins/bootstrap/bootstrap.min.js></script><script src=https://blog.yukatayu.tech/plugins/slick/slick.min.js></script><script src=https://blog.yukatayu.tech/plugins/venobox/venobox.min.js></script><script src=https://blog.yukatayu.tech/plugins/search/fuse.min.js></script><script src=https://blog.yukatayu.tech/plugins/search/mark.js></script><script src=https://blog.yukatayu.tech/plugins/search/search.js></script><script src=https://blog.yukatayu.tech/js/script.min.js></script></body></html>